<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Classic Chat Interface</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.4.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
    font-family: Arial, sans-serif;
    background-color: #ffff;
    margin: 0;
    padding: 1rem;
    height: 100vh;
    display:flex;
    justify-content: center;
    align-items: center;
    overflow: hidden; /* Disable scrolling */
}
.chat-container {
    border-radius: 1rem;
    padding: 1rem;
    background-color: #fff;
    height: calc(100vh - 120px); /* Subtracting padding and margin */
    overflow-y: auto; /* Enable vertical scrolling */
    width: 750px; /* Set width for the container */
    margin: 0 auto;/* Center the container horizontally */
    overflow-x: auto; /* Or any overflow value if needed */
  overflow-wrap: break-word; /* Wrap long words */
   padding-top: 0px;
   
      
}
/* For mobile devices (up to 576px) */
@media (max-width: 576px) {
    .chat-container {
        width: 100%; /* Full width on mobile */
        max-width: none; /* No maximum width */
        padding: 1rem; /* Adjust padding as needed */
        margin: 0 auto; /* Center the container horizontally */
        overflow-x: hidden; /* Prevent horizontal scrolling */
    }
}

/* For tablets (between 577px and 992px) */
@media (min-width: 577px) and (max-width: 992px) {
    .chat-container {
        width: 90%; /* 90% width on tablets */
        max-width: none; /* No maximum width */
        padding: 1.5rem; /* Adjust padding as needed */
        margin: 0 auto; /* Center the container horizontally */
        overflow-x: hidden; /* Prevent horizontal scrolling */
    }
}



/* For laptops and desktops (992px and above) */
@media (min-width: 993px) {
    .chat-container {
        width: 750px; /* Specific width for laptops/desktops */
        max-width: 100%; /* Allow container to be smaller than 750px if needed */
        padding: 2rem; /* Adjust padding as needed */
        margin: 0 auto; /* Center the container horizontally */
    }
}
.chat-message {
    margin-bottom: 10px;
    
}
#user-message {
    background-color: #f0f4f9; /* Light blue background for user messages */
    padding: 18px;
    border-radius: 5px;
    margin-bottom: 10px;
    margin-left: 0%;
}

#response-message { 
    padding: 10px;
    border-radius: 5px;
    margin-bottom: 10px;
}
#additional-question {
    position: relative;
    padding: 10px;
    border-radius: 5px;
    margin-bottom: 10px;
    overflow: hidden; /* Ensure relative positioning for the ::after pseudo-element */
    list-style-type: none;
    background-color: #f0f4f9;
}
#additional-question::before {
    content: " "; /* Empty content to avoid showing "Additional Question:" */
    display: block;
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 1; /* Ensure it's above the actual content */
   
}
#additional-question p {
    margin: 0px; /* Remove default margin for paragraph */
    z-index: 2; /* Ensure it's below the pseudo-element */
   
}
#additional-question::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    width: 100%;
    height: 2px; /* Adjust the height of the line as needed */
    background-color:  #666666; /* Black color for the line */
}

#history-sidebar {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    bottom: 0;
    width: 200px;
    padding: 20px;
    background-color:  #f0f4f9; 
    border-right: 1px solid #ccc;
    z-index: 1000;
    padding-left: 0%;
    
}
.sidebar-opened #history-sidebar {
    display: block;
}
#chat-messages {
    border-radius: 5px;
    padding: 10px;
}
.input-group {
    margin-bottom: 80px;
    width: 100%; /* Set width for the input group */
    display: flex;
    align-items: center;
    margin-bottom: 20px;
    
}
.input-group {
    position: relative; /* Set position to relative */
    margin-bottom: 40px; /* Adjust margin as needed */
    margin-left: 80px;
}

.form-control {
    flex: 2; /* Use all available space */ 
    border: 2px solid #5a5959;
    transition: width 0.3s, border-color 0.3s;
    width: calc(100% - 120px); /* Adjust the subtraction value to keep the desired width */
    height: 50px; /* Set your desired height */
    padding: 12px;
    font-size: 12px;
    border: 1px solid #ccc;
    border-radius: 9px;
    box-sizing: border-box;
}
.form-control:focus {
    outline: none;
    border-color: #942bc5;
    transition: width 0.3s, border-color 0.3s;
}
/* For mobile devices (up to 576px) */
@media (max-width: 576px) {
    .input-group {
        margin-bottom: none; /* Adjust margin as needed */
        margin-left: 0; /* Reset left margin */
        width: 100%; /* Full width on mobile */
        padding: 0; /* Reset padding */
    }

    .form-control {
        width: 100%; /* Full width for form control */
        margin-right: 0; /* Reset right margin */
    }
}

/* For tablets (between 577px and 992px) */
@media (min-width: 577px) and (max-width: 992px) {
    .input-group {
        margin-bottom: none; /* Adjust margin as needed */
        margin-left: 0; /* Reset left margin */
        width: 100%; /* Full width on tablets */
        padding: 0; /* Reset padding */
    }

    .form-control {
        width: 100%; /* Full width for form control */
        margin-right: 0; /* Reset right margin */
    }
}

/* For laptops and desktops (992px and above) */
@media (min-width: 993px) {
    .input-group {
        margin-bottom: 5rem; /* Adjust margin as needed */
        margin-left: 80px; /* Restore left margin for laptops/desktops */
        width: calc(100% - 120px); /* Adjust width for laptops/desktops */
        padding: 0; /* Reset padding */
    }

    .form-control {
        width: calc(100% - 120px); /* Adjust width for form control */
        margin-right: 0; /* Reset right margin */
    }
}
.btn-primary {
    background-color:  #f0f4f9; 
    border-radius: 20px;
    padding: 10px 20px;
    border: none;
    transition: background-color 0.3s, border-color 0.3s;
    width: 100%; /* Make buttons take full width */
    text-align: left; /* Align button text to left */
}
.btn-primary:hover {
    background-color:  #f0f4f9; 
}
.btn-primary1 {
    background-color: #ffff;
    border-radius: 20px;
    padding: 10px 20px;
    border: none;
    transition: background-color 0.3s, border-color 0.3s;
}
.btn-link {
    color: #3498db;
    text-decoration: none;
    transition: color 0.3s;
}
.btn-link:hover {
    text-decoration: underline;
    color: #2980b9;
}
.footer-buttons {
    position: fixed;
    bottom: 20px;
    right: 20px;
    z-index: 1000;
}
#open-sidebar-btn {
    position: fixed;
    top: 20px;
    left: 20px;
    z-index: 1000;
}
.close-sidebar-btn {
    position: absolute;
    top: 20px;
    right: 20px;
}
.sidebar-opened .form-control {
    width: 20px;
}
.sidebar-opened .form-control:focus {
    width: 200px;
}
#new {
    padding-top: 25dvh;
}
#account {
    padding-top: 25dvh;
}
#button-container {
    position: absolute; /* Position the button container absolutely */
    right: 0; /* Align to the right */
    top: 50%; /* Align vertically to the middle */
    transform: translateY(-50%); /* Adjust vertical alignment */
}

.user-message {
    background-color: #e0f7fa; /* Light blue color */
    padding: 10px;
    border-radius: 5px;
    margin-bottom: 10px;
}

#voice-command-button,
#send-button {
    margin-left: 5px; /* Add margin between buttons */
    border-radius: 20px; /* Add border radius to buttons */
}

.form-control {
    padding-right: 100px; /* Add space on the right for the buttons */
}

#send-button {
    display: inline-block; /* Ensure the button is displayed inline */
}
#audio-container {
            margin-top: 20px;
        }
        #audio-player {
            display: none; /* Hide by default */
        }
        #listen-btn {
            display: none;
            margin-top: 10px;
            color: black;
            background-color: #ccc;
            border: none;
            border-radius: 25px;
            cursor: pointer;
        }



    </style>
</head>
<body class="sidebar-opened">
    <div class="container">
        <div class="row">
            <div class="col-lg-4 col-md-6 col-sm-8">
                <div id="history-sidebar">
                    <h5>Chat History</h5>
                    <button class="close-sidebar-btn btn btn-primary" id="cross">
                        <img src="/static/img/cross-removebg-preview.png" alt="Close Sidebar" style="width: 18px; height: 18px; float: right; ">
                        
                    </button>
                    
                    <div id="chatHistory"></div>
                    <button class="btn btn-primary mt-3" onclick="newChat()" id="new" style="display: flex; align-items: center;"><img src="/static/img/chat-removebg-preview.png" alt=""style="width:25px;height: 25px;margin-right: 5px;">New Chat</button>                    <!-- Add this button to your main chat page -->
                    <button class="btn btn-primary mt-3" onclick="window.location.href='https://dev-chat-box.pantheonsite.io/chat_history/'" style="display: flex; align-items: center;">
    <img src="/static/img/history-removebg-preview (1).png" alt="" style="width:25px;height: 25px;margin-right: 5px;">
    History
                    </button>
                    <button class="btn btn-primary mt-3" onclick="upgrade()" style="display: flex; align-items: center;">
                        <img src="/static/img/upgrade-removebg-preview.png" alt="" style="width:25px;height: 25px;margin-right: 5px;">
                         <a href="https://dev-chat-box.pantheonsite.io/upgrade/" style="color: #000;text-decoration: none;">upgrade</a>
                    </button>
                    <button class="btn btn-primary mt-3" onclick="upgrade()" style="display: flex; align-items: center;">
                        <img src="/static/img/support-removebg-preview.png" alt="" style="width:28px;height: 25px;margin-right: 5px;">
                         <a href="https://dev-chat-box.pantheonsite.io/support/" style="color: #000;text-decoration: none;">Support</a>
                    </button>
                    <button class="btn btn-primary mt-3" onclick="upgrade()" id="account"  style="display: flex; align-items: center;">
                        <img src="/static/img/account-removebg-preview.png" alt="" style="width:26px;height: 26px;margin-right: 5px;">
                         <a href="https://dev-chat-box.pantheonsite.io/account/" style="color: #000;text-decoration: none;">Account</a>
                    </button>
                </div>
            </div>

            <div class="col-lg-4 col-md-6 col-sm-8">
                <div class="chat-container">
                    <div id="chat-messages"></div>
                    <div id="document-session-container" style="display: none;"></div>
                    <div id="audio-container">
                        <audio id="audio-player"  style="display: none;"></audio>
                        <button id="listen-btn"><img src="/static/img/8c836e8b-a205-448f-9410-50456635b2b1.jpg" alt="audio button" style="width:25px;height: 25px;"></button>
                        <div id="document-session-container" style="display: none;"></div>
                    </div>
                </div>
                <div id="fixed-question-container">
                    <form id="chat-form" class="mb-3">
                        <div class="input-group">
                            <input type="text" id="user-input" class="form-control" placeholder="Type your message..." >
                            <div id="button-container">
                                <button type="button" id="voice-command-button" class="btn btn-primary" style="background-color: transparent; ">
                                    <img src="/static/img/voice-removebg-preview final.png" alt="voice-command-button" style="width: 18px; height: 25px; margin-right: 5px;">
                                  </button>
                                  
                                <button type="submit" id="send-button" class="btn btn-primary" style="display: none;background-color: transparent;">
                                    <img src="/static/img/send-removebg-preview.png" alt="voice-command-button" style="width: 38px; height: 30px; margin-right: 0px;">
                                </button>
                            </div>
                            </div>
                            
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <button id="open-sidebar-btn" class="btn btn-primary1"style="padding: 3px;"><img src="/static/img/icon-removebg-preview (1).png" alt="open sidebar " style="height: 40px; width: 40px;">
        
    </button>    
    <div class="footer-buttons">
        <button id="close-sidebar-btn" class="btn btn-primary" style="display: none;"><img src="/static/img/cross.png" alt="Close Sidebar"></button>
    </div>



<script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
<script>
$(document).ready(function() {
    const $userInput = $('#user-input');
    const $voiceButton = $('#voice-command-button');
    const $sendButton = $('#send-button');
    const $chatMessages = $('#chat-messages');
    const $audioContainer = $('#audio-container');
    const $listenBtn = $('#listen-btn');
    const $audioPlayer = $('#audio-player');
    const documentSessionContainer = document.getElementById('document-session-container');

    
    
    function toggleAudioButton(audioDataAvailable) {
        if (audioDataAvailable) {
            $audioContainer.show(); // Show the audio container
            $listenBtn.show(); // Show the listen button
        } else {
            $audioContainer.hide(); // Hide the audio container
            $listenBtn.hide(); // Hide the listen button
        }
    }

    function hideAudioButton() {
        $audioContainer.hide(); // Hide the audio container
        $listenBtn.hide(); // Hide the listen button
    }


    // Function to handle backend response
    function handleResponse(response) {
        const { response_text, additional_questions, audio_data, document_session } = response;

         // Display the response text in the chat interface
         appendMessage('assistant', response_text, 'response');
        toggleAudioButton(audio_data !== null); // Toggle audio button based on audio data availability
        if (audio_data) {
            $audioPlayer.attr('src', 'data:audio/wav;base64,' + audio_data);
            $audioContainer.show(); // Show the audio container
            $listenBtn.show(); // Show the listen button
        }

        

        

        // Handle additional questions if present
        if (additional_questions && additional_questions.length > 0) {
            additional_questions.forEach((question, index) => {
                appendMessage('assistant', `${question}`, 'additional_question');
            });
        }


 // Create a button element
const button = document.createElement('button');
button.textContent = 'Show Document Session';
button.addEventListener('click', function() {
    // Check if the document session element already exists
    let documentSessionElement = document.querySelector('.document-session');

    if (documentSessionElement) {
        // If it exists, toggle its visibility
        if (documentSessionElement.style.display === 'none' || documentSessionElement.style.display === '') {
            documentSessionElement.style.display = 'block';
        } else {
            documentSessionElement.style.display = 'none';
        }
    } else {
        // If it does not exist, create and append it
        if (document_session) {
            documentSessionElement = document.createElement('div');
            documentSessionElement.classList.add('response', 'document-session');
            documentSessionElement.textContent = document_session;
            $chatMessages.append(documentSessionElement);
        }
    }
});

// Append the button to the chat interface
$chatMessages.append(button);



        scrollToBottom();
    }



    

    // Function to send user message to the backend and handle response
    function sendMessageToBackend(message) {
        $.ajax({
            type: 'POST',
            url: '/chat', // Backend endpoint URL
            contentType: 'application/json',
            data: JSON.stringify({ user_question: message }),
            success: function(response) {
                handleResponse(response);
            },
            error: function(xhr, status, error) {
                console.error('Error sending message:', error);
            }
        });
    }
    // Function to toggle between voice and send buttons based on input value
    function toggleButtons() {
        const inputValue = $userInput.val().trim();
        if (inputValue !== '') {
            $voiceButton.hide();
            $sendButton.show();
        } else {
            $voiceButton.show();
            $sendButton.hide();
        }
    }

    // Event listener for input change
    $userInput.on('input', function() {
        toggleButtons(); // Toggle buttons based on input value
    });

    // Event listener for form submission (send button)
    $('#chat-form').submit(function(event) {
        event.preventDefault();
        const userQuestion = $userInput.val().trim();
        if (userQuestion !== '') {
            appendMessage('user', userQuestion, 'user');
            sendMessageToBackend(userQuestion);
            $userInput.val('');
            toggleButtons(); // Toggle buttons after sending message
        }
    });

    // Function to save chat history in local storage
function saveChatHistory(role, message) {
    let chatHistory = JSON.parse(localStorage.getItem('chatHistory')) || [];
    chatHistory.push({ role, text: message });
    localStorage.setItem('chatHistory', JSON.stringify(chatHistory));
}


    // Function to append message to chat interface with specific message type
    function appendMessage(role, message, type) {
        let messageElement;
        if (type === 'user') {
            messageElement = `<div id="user-message" class="chat-message">${message}</div>`;
        } else if (type === 'response') {
            messageElement = `<div id="response-message" class="chat-message">${message}</div>`;
        } else if (type === 'additional_question') {
            messageElement = `<div id="additional-question" class="chat-message">${message}</div>`;
        } else {
            // Default message style
            messageElement = `<div class="chat-message">${message}</div>`;
        }

        $chatMessages.append(messageElement);
        saveChatHistory(role, message); // Save message to chat history
        scrollToBottom();
    }

    // Function to scroll to bottom of chat
    function scrollToBottom() {
        $chatMessages.animate({
            scrollTop: $chatMessages.prop("scrollHeight")
        }, 500);
    }

    $('#listen-btn').on('click', function() {
        if ($audioPlayer[0].paused) {
            $audioPlayer[0].play();
            $listenBtn.html('<img src="/static/img/8c836e8b-a205-448f-9410-50456635b2b1.jpg" alt="" style="width:28px;height: 26px;">');
        } else {
            $audioPlayer[0].pause();
            $listenBtn.html('<img src="/static/img/8c836e8b-a205-448f-9410-50456635b2b1.jpg" alt="" style="width:28px;height: 26px;">');
        }
    });
    

    // Voice command button click event
    $('#voice-command-button').click(function() {
        voiceCommand(); // Call the voiceCommand function
    });

    // Function for voice command
    function voiceCommand() {
        var recognition = new webkitSpeechRecognition();
        recognition.lang = 'en-US';
        recognition.onresult = function(event) {
            var transcript = event.results[0][0].transcript;
            $userInput.val(transcript);
            $('#input').submit(); // Submit the form after setting the input value
        };
        recognition.start();
    }
     // Function to show chat history
     function showChatHistory() {
            // Assuming this function displays chat history (not defined in the provided code)
        }

        // Function to start a new chat and refresh the page
        function newChat() {
            location.reload(); // Reload the page
        }
        

        // Open sidebar button click event
        $('#open-sidebar-btn').click(function() {
            $('body').addClass('sidebar-opened');
            $('#open-sidebar-btn').hide();
            $('.close-sidebar-btn').show();
            adjustInputWidth();
        });

        // Close sidebar button click event
        $('.close-sidebar-btn').click(function() {
            $('body').removeClass('sidebar-opened');
            $('#open-sidebar-btn').show();
            $('.close-sidebar-btn').hide();
            adjustInputWidth();
        });

        // Automatically open sidebar when the page loads (assuming this behavior)
        $('body').addClass('sidebar-opened');
        $('#open-sidebar-btn').hide();
        $('.close-sidebar-btn').show();
        adjustInputWidth(); // Assuming this function is defined elsewhere
    }); 

</script>
</body>
</html>